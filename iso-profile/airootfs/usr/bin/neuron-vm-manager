#!/usr/bin/env python3
"""
NeuronVM Manager - Entry point
Manages Windows/macOS VMs with GPU passthrough
"""

import sys
sys.path.insert(0, '/usr/lib/neuron-os')

def main():
    # Check if GTK4 is available
    try:
        import gi
        gi.require_version('Gtk', '4.0')
        gi.require_version('Adw', '1')
        from gi.repository import Gtk, Adw

        from vm_manager.gui.app import VMManagerApp
        app = VMManagerApp()
        return app.run(sys.argv)

    except (ImportError, ValueError) as e:
        print(f"GTK4 not available: {e}")
        print("Falling back to CLI mode...")

        # CLI fallback
        from vm_manager.core.libvirt_manager import LibvirtManager

        manager = LibvirtManager()
        if not manager.connect():
            print("Failed to connect to libvirt")
            return 1

        print("NeuronVM Manager (CLI Mode)")
        print("=" * 40)

        vms = manager.list_vms()
        if vms:
            print(f"\nFound {len(vms)} VMs:")
            for vm in vms:
                status = "ðŸŸ¢ Running" if vm.state.value == 1 else "âšª Stopped"
                gpu = "ðŸŽ® GPU" if vm.has_gpu_passthrough else ""
                print(f"  {vm.name}: {status} {gpu}")
        else:
            print("\nNo VMs configured.")
            print("\nTo create a Windows VM with GPU passthrough:")
            print("  1. Run: neuron-hardware-detect check")
            print("  2. Run: virt-manager (GUI)")
            print("  3. Or wait for NeuronVM Manager GUI")

        manager.disconnect()
        return 0


if __name__ == '__main__':
    sys.exit(main())
